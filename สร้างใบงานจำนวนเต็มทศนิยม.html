<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏ö‡∏á‡∏≤‡∏ô‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏ï‡πá‡∏°‡∏ó‡∏®‡∏ô‡∏¥‡∏¢‡∏°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']]
            },
            svg: {
                fontCache: 'global'
            }
        };
    </script>
    <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        .problem-content .text-xl {
    font-family: 'Sarabun', sans-serif;
}
#answer-key-content {
    font-family: 'Sarabun', sans-serif;
}

.print-answers {
    font-family: 'Sarabun', sans-serif;
}
        body {
            font-family: 'Kanit', sans-serif;
            background-color: #F0F9FF;
        }
        .control-panel {
            background-color: white;
            border-radius: 1.5rem;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23d1e9ff' fill-opacity='0.4'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }
        .worksheet-container {
            display: flex;
            flex-wrap: wrap;
            width: 210mm;
            height: 297mm;
            margin: auto;
            background: white;
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
        }
.problem-box {
    width: 50%;
    height: 50%;
    box-sizing: border-box;
    padding: 0.4cm;
    border: 1px solid #E5E7EB;
    display: flex;
    flex-direction: column;
}
        .problem-content {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }
        .problem-number {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 9999px;
            background-color: #3B82F6;
            color: white;
            font-size: 1.25rem;
            font-weight: 600;
            flex-shrink: 0;
        }
.method-area {
    flex-grow: 1;
    border-radius: 0.5rem;
    margin-top: 0.5rem;
    width: 100%;
    height: 100%;
    background-image:
        linear-gradient(to right, #d1e9ff 1px, transparent 1px),
        linear-gradient(to bottom, #d1e9ff 1px, transparent 1px);
    background-size: 10% 10%;
    border: 1px solid #BFDBFE;
}
        .footer-info { border-top: 1px solid #D1D5DB; padding-top: 0.5rem; margin-top: 0.5rem; font-size: 0.9rem; }
        .btn-primary { background-color: #2563EB; color: white; transition: background-color 0.3s; }
        .btn-primary:hover { background-color: #1D4ED8; }
        .btn-secondary { background-color: #10B981; color: white; transition: background-color 0.3s; }
        .btn-secondary:hover { background-color: #059669; }
        .btn-accent { background-color: #F59E0B; color: white; transition: background-color 0.3s; }
        .btn-accent:hover { background-color: #D97706; }
        #answer-key-modal {
            background-color: rgba(0,0,0,0.5);
        }
        .print-answers {
            display: none;
        }
        @media print {
            body {
                background-color: white !important;
                margin: 0 !important;
                padding: 0 !important;
            }
            .control-panel, .header-banner, .button-container, #answer-key-modal {
                display: none !important;
            }
            #worksheet-pages {
                margin: 0 !important;
            }
            .worksheet-container {
                width: 100%;
                height: 100vh;
                box-shadow: none !important;
                margin: 0 !important;
                padding: 0 !important;
                border: none !important;
                page-break-after: always;
            }
            .problem-box {
                border: 1px solid #ccc !important;
            }
            .print-answers {
                display: block !important;
            }
        }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="header-banner text-center mb-8">
        <h1 class="text-4xl md:text-5xl font-bold text-blue-800">üìñ ‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏´‡∏£‡∏£‡∏©‡∏≤ ‡∏Å‡∏±‡∏ö‡∏û‡∏µ‡πà‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ üìñ</h1>
        <p class="text-lg text-blue-600 mt-2">‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏ö‡∏á‡∏≤‡∏ô‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏ï‡πá‡∏°‡πÅ‡∏•‡∏∞‡∏ó‡∏®‡∏ô‡∏¥‡∏¢‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ô‡πâ‡∏≠‡∏á‡πÜ ‡∏õ‡∏£‡∏∞‡∏ñ‡∏°</p>
    </div>

    <div class="flex flex-col md:flex-row gap-8">
        <div class="w-full md:w-1/3 lg:w-1/4 control-panel p-6 self-start">
            <h2 class="text-2xl font-bold text-blue-700 mb-6 border-b-2 border-blue-200 pb-2">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏ö‡∏á‡∏≤‡∏ô</h2>
            
            <div class="mb-4">
                <label class="block text-gray-700 font-bold mb-2">1. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÇ‡∏à‡∏ó‡∏¢‡πå</label>
                <div class="grid grid-cols-2 gap-2">
                    <button onclick="setOperation('+')" id="op-add" class="op-btn p-3 rounded-lg text-xl bg-blue-500 text-white shadow-md transition-transform transform hover:scale-105">+</button>
                    <button onclick="setOperation('-')" id="op-sub" class="op-btn p-3 rounded-lg text-xl bg-white text-gray-800 shadow-md transition-transform transform hover:scale-105">-</button>
                    <button onclick="setOperation('*')" id="op-mul" class="op-btn p-3 rounded-lg text-xl bg-white text-gray-800 shadow-md transition-transform transform hover:scale-105">√ó</button>
                    <button onclick="setOperation('/')" id="op-div" class="op-btn p-3 rounded-lg text-xl bg-white text-gray-800 shadow-md transition-transform transform hover:scale-105">√∑</button>
                </div>
            </div>

            <div class="mb-4">
                <label for="numProblems" class="block text-gray-700 font-bold mb-2">2. ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡πâ‡∏≠ (‡∏´‡∏≤‡∏£ 4 ‡∏•‡∏á‡∏ï‡∏±‡∏ß)</label>
                <input type="number" id="numProblems" value="4" min="4" step="4" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            </div>

            <div class="border-t pt-4 mt-4">
                <label class="block text-gray-700 font-bold mb-2">3. ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà 1</label>
                <select id="type1" onchange="toggleRangeSettings(1)" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    <option value="integer">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏ï‡πá‡∏°</option>
                    <option value="decimal">‡∏ó‡∏®‡∏ô‡∏¥‡∏¢‡∏°</option>
                </select>
                <div id="range-settings-1" class="mt-2 space-y-2">
                    <div id="num1-range-container">
                        <label class="text-sm text-gray-600">‡∏ä‡πà‡∏ß‡∏á‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç</label>
                        <div class="flex gap-2">
                            <input type="number" id="num1_min" value="1" min="0" class="w-full p-1 border border-gray-200 rounded text-sm" placeholder="‡∏ï‡πà‡∏≥‡∏™‡∏∏‡∏î">
                            <input type="number" id="num1_max" value="100" min="0" class="w-full p-1 border border-gray-200 rounded text-sm" placeholder="‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î">
                        </div>
                    </div>
                    <div id="decimal1-container" style="display: none;">
                        <label class="text-sm text-gray-600">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏®‡∏ô‡∏¥‡∏¢‡∏°</label>
                        <input type="number" id="decimal1_places" value="2" min="0" max="5" class="w-full p-1 border border-gray-200 rounded text-sm" placeholder="‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á">
                    </div>
                </div>
            </div>

            <div class="border-t pt-4 mt-4">
                <label class="block text-gray-700 font-bold mb-2">4. ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà 2</label>
                <select id="type2" onchange="toggleRangeSettings(2)" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    <option value="integer">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏ï‡πá‡∏°</option>
                    <option value="decimal">‡∏ó‡∏®‡∏ô‡∏¥‡∏¢‡∏°</option>
                </select>
                <div id="range-settings-2" class="mt-2 space-y-2">
                    <div id="num2-range-container">
                        <label class="text-sm text-gray-600">‡∏ä‡πà‡∏ß‡∏á‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç</label>
                        <div class="flex gap-2">
                            <input type="number" id="num2_min" value="1" min="0" class="w-full p-1 border border-gray-200 rounded text-sm" placeholder="‡∏ï‡πà‡∏≥‡∏™‡∏∏‡∏î">
                            <input type="number" id="num2_max" value="100" min="0" class="w-full p-1 border border-gray-200 rounded text-sm" placeholder="‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î">
                        </div>
                    </div>
                    <div id="decimal2-container" style="display: none;">
                        <label class="text-sm text-gray-600">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏®‡∏ô‡∏¥‡∏¢‡∏°</label>
                        <input type="number" id="decimal2_places" value="2" min="0" max="5" class="w-full p-1 border border-gray-200 rounded text-sm" placeholder="‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á">
                    </div>
                </div>
            </div>

            <div class="border-t pt-4 mt-4">
                <label class="block text-gray-700 font-bold mb-2">5. ‡∏ä‡πà‡∏ß‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö</label>
                <div class="flex gap-2">
                    <input type="number" id="answer_min" value="0" min="0" class="w-full p-1 border border-gray-200 rounded text-sm" placeholder="‡∏ï‡πà‡∏≥‡∏™‡∏∏‡∏î">
                    <input type="number" id="answer_max" value="1000" min="0" class="w-full p-1 border border-gray-200 rounded text-sm" placeholder="‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î">
                </div>
            </div>

            <div class="border-t pt-4 mt-4">
                <label class="block text-gray-700 font-bold mb-2">6. ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö</label>
                <select id="answer_type" onchange="toggleAnswerSettings()" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    <option value="integer">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏ï‡πá‡∏°</option>
                    <option value="decimal">‡∏ó‡∏®‡∏ô‡∏¥‡∏¢‡∏°</option>
                    <option value="remainder" disabled>‡πÅ‡∏ö‡∏ö‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏®‡∏© (‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡∏´‡∏≤‡∏£)</option>
                </select>
                <div id="answer-decimal-container" class="mt-2" style="display: none;">
                    <label class="text-sm text-gray-600">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏®‡∏ô‡∏¥‡∏¢‡∏°</label>
                    <input type="number" id="answer_decimal_places" value="2" min="0" max="5" class="w-full p-1 border border-gray-200 rounded text-sm" placeholder="‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á">
                </div>
            </div>

            <button id="generateBtn" class="w-full btn-primary font-bold py-3 px-4 rounded-lg text-lg shadow-lg hover:shadow-xl transition-all duration-300 transform hover:-translate-y-1 mt-6">
                ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏ö‡∏á‡∏≤‡∏ô
            </button>
        </div>

        <div class="w-full md:w-2/3 lg:w-3/4">
            <div class="button-container text-right mb-4 flex justify-end gap-2">
                <button id="showAnswerKeyBtn" class="btn-accent font-bold py-2 px-6 rounded-lg shadow-md hover:shadow-lg transition-all transform hover:-translate-y-0.5">
                    üßÆ ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏â‡∏•‡∏¢
                </button>
                <button onclick="window.print()" class="btn-secondary font-bold py-2 px-6 rounded-lg shadow-md hover:shadow-lg transition-all transform hover:-translate-y-0.5">
                    üñ®Ô∏è ‡∏û‡∏¥‡∏°‡∏û‡πå‡πÉ‡∏ö‡∏á‡∏≤‡∏ô
                </button>
            </div>
            <div id="worksheet-pages"></div>
        </div>
    </div>

    <div id="answer-key-modal" class="fixed inset-0 z-50 items-center justify-center p-4 hidden">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-2xl max-h-full overflow-y-auto">
            <div class="p-6">
                <div class="flex justify-between items-center border-b pb-3 mb-4">
                    <h3 class="text-2xl font-bold text-blue-800">‡πÄ‡∏â‡∏•‡∏¢‡πÉ‡∏ö‡∏á‡∏≤‡∏ô</h3>
                    <button id="closeAnswerKeyBtn" class="text-gray-500 hover:text-gray-800 text-3xl">&times;</button>
                </div>
                <div id="answer-key-content" class="text-lg space-y-2"></div>
            </div>
        </div>
    </div>

    <div id="print-answer-key" class="print-answers"></div>

    <script>
        let currentOperation = '+';
        let generatedProblems = [];
        const generateBtn = document.getElementById('generateBtn');
        const worksheetPages = document.getElementById('worksheet-pages');
        const showAnswerKeyBtn = document.getElementById('showAnswerKeyBtn');
        const closeAnswerKeyBtn = document.getElementById('closeAnswerKeyBtn');
        const answerKeyModal = document.getElementById('answer-key-modal');
        const answerKeyContent = document.getElementById('answer-key-content');
        const printAnswerKeyContainer = document.getElementById('print-answer-key');

        function getRandomInt(min, max) {
            min = Math.ceil(min);
            max = Math.floor(max);
            if (min > max) [min, max] = [max, min];
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        function getRandomDecimal(min, max, places) {
            const num = Math.random() * (max - min) + min;
            return Number(num.toFixed(places));
        }

        function createNumber(type, min, max, places) {
            if (type === 'integer') {
                return getRandomInt(min, max);
            } else {
                return getRandomDecimal(min, max, places);
            }
        }

        function formatNumber(num, type, places) {
            if (type === 'integer') {
                return Math.round(num).toLocaleString('en-US');
            } else {
                return num.toLocaleString('en-US', { minimumFractionDigits: places, maximumFractionDigits: places });
            }
        }

        function calculate(n1, n2, op, answerType, answerPlaces) {
            let result;
            switch (op) {
                case '+': result = n1 + n2; break;
                case '-': result = n1 - n2; break;
                case '*': result = n1 * n2; break;
                case '/': result = n1 / n2; break;
            }

            if (op === '/' && answerType === 'remainder') {
                const quotient = Math.floor(n1 / n2);
                const remainder = n1 % n2;
                return { quotient, remainder };
            }

            if (answerType === 'integer') {
                return Math.round(result);
            } else {
                return Number(result.toFixed(answerPlaces));
            }
        }

        function formatAnswer(result, answerType, answerPlaces) {
            if (answerType === 'remainder') {
                return result.remainder === 0 ? `${result.quotient}` : `${result.quotient} ‡πÄ‡∏®‡∏© ${result.remainder}`;
            }
            return formatNumber(result, answerType, answerPlaces);
        }

        function setOperation(op) {
            currentOperation = op;
            document.querySelectorAll('.op-btn').forEach(btn => {
                btn.classList.remove('bg-blue-500', 'text-white');
                btn.classList.add('bg-white', 'text-gray-800');
            });
            const selectedBtn = document.getElementById({ '+': 'op-add', '-': 'op-sub', '*': 'op-mul', '/': 'op-div' }[op]);
            selectedBtn.classList.remove('bg-white', 'text-gray-800');
            selectedBtn.classList.add('bg-blue-500', 'text-white');
            toggleAnswerSettings();
        }

        function toggleRangeSettings(num) {
            const type = document.getElementById(`type${num}`).value;
            const decimalContainer = document.getElementById(`decimal${num}-container`);
            decimalContainer.style.display = type === 'decimal' ? 'block' : 'none';
        }

        function toggleAnswerSettings() {
            const answerTypeSelect = document.getElementById('answer_type');
            const answerDecimalContainer = document.getElementById('answer-decimal-container');
            const remainderOption = answerTypeSelect.querySelector('option[value="remainder"]');
            remainderOption.disabled = currentOperation !== '/';
            if (currentOperation !== '/' && answerTypeSelect.value === 'remainder') {
                answerTypeSelect.value = 'integer';
            }
            answerDecimalContainer.style.display = answerTypeSelect.value === 'decimal' ? 'block' : 'none';
        }

        function generateWorksheet() {
            generateBtn.disabled = true;
            generateBtn.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á...';

            const numProblems = parseInt(document.getElementById('numProblems').value);
            const type1 = document.getElementById('type1').value;
            const num1Min = parseFloat(document.getElementById('num1_min').value);
            const num1Max = parseFloat(document.getElementById('num1_max').value);
            const decimal1Places = parseInt(document.getElementById('decimal1_places').value) || 0;
            
            const type2 = document.getElementById('type2').value;
            const num2Min = parseFloat(document.getElementById('num2_min').value);
            const num2Max = parseFloat(document.getElementById('num2_max').value);
            const decimal2Places = parseInt(document.getElementById('decimal2_places').value) || 0;

            const answerMin = parseFloat(document.getElementById('answer_min').value);
            const answerMax = parseFloat(document.getElementById('answer_max').value);
            const answerType = document.getElementById('answer_type').value;
            const answerDecimalPlaces = parseInt(document.getElementById('answer_decimal_places').value) || 0;

            if (numProblems % 4 !== 0 || numProblems <= 0) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà‡∏´‡∏≤‡∏£ 4 ‡∏•‡∏á‡∏ï‡∏±‡∏ß‡πÅ‡∏•‡∏∞‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 0');
                generateBtn.disabled = false;
                generateBtn.textContent = '‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏ö‡∏á‡∏≤‡∏ô';
                return;
            }

            const problemSet = new Set();
            generatedProblems = [];
            let attempts = 0;

            while (generatedProblems.length < numProblems && attempts < 2000) {
                let n1 = createNumber(type1, num1Min, num1Max, decimal1Places);
                let n2 = createNumber(type2, num2Min, num2Max, decimal2Places);

                if (currentOperation === '/' && n2 === 0) {
                    attempts++;
                    continue;
                }
                if (currentOperation === '-' && n1 < n2) [n1, n2] = [n2, n1];

                const result = calculate(n1, n2, currentOperation, answerType, answerDecimalPlaces);
                if (answerType === 'remainder' && (result.quotient < answerMin || result.quotient > answerMax)) {
                    attempts++;
                    continue;
                }
                if (answerType !== 'remainder' && (result < answerMin || result > answerMax)) {
                    attempts++;
                    continue;
                }

                const opSymbol = currentOperation === '*' ? '√ó' : currentOperation === '/' ? '√∑' : currentOperation;
                const problemString = `${formatNumber(n1, type1, decimal1Places)} ${opSymbol} ${formatNumber(n2, type2, decimal2Places)}`;

                if (!problemSet.has(problemString)) {
                    problemSet.add(problemString);
                    generatedProblems.push({
                        question: problemString,
                        answer: formatAnswer(result, answerType, answerDecimalPlaces)
                    });
                }
                attempts++;
            }

            if (generatedProblems.length < numProblems) {
                alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏à‡∏ó‡∏¢‡πå‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏õ‡∏£‡∏±‡∏ö‡∏ä‡πà‡∏ß‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö');
                generateBtn.disabled = false;
                generateBtn.textContent = '‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏ö‡∏á‡∏≤‡∏ô';
                return;
            }

            renderWorksheet(generatedProblems);
        }

        function renderWorksheet(problems) {
            worksheetPages.innerHTML = '';
            const numPages = Math.ceil(problems.length / 4);

            for (let p = 0; p < numPages; p++) {
                const page = document.createElement('div');
                page.className = 'worksheet-container mb-8';
                let pageContent = '';
                for (let i = 0; i < 4; i++) {
                    const problemIndex = p * 4 + i;
                    if (problemIndex < problems.length) {
                        pageContent += `
                            <div class="problem-box">
                                <div class="problem-content">
                                    <div class="flex items-center gap-3 mb-2">
                                        <div class="problem-number">${problemIndex + 1}</div>
                                        <div class="text-xl md:text-2xl py-2">${problems[problemIndex].question} = ?</div>
                                    </div>
                                    <div class="flex-grow flex flex-col">
                                        <p class="font-semibold text-gray-600">‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏≥:</p>
                                        <div class="method-area"></div>
                                    </div>
                                </div>
                                <div class="footer-info">
                                    <div class="mb-2"><strong>‡∏ï‡∏≠‡∏ö:</strong>  _________________</div>
                                    <div><strong>‡∏ä‡∏∑‡πà‡∏≠:</strong> _________________________ <strong>‡∏ä‡∏±‡πâ‡∏ô:</strong> ____</div>
                                    <div><strong>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà:</strong> ____</div>
                                </div>         
                            </div>`;
                    }
                }
                page.innerHTML = pageContent;
                worksheetPages.appendChild(page);
            }

            generateBtn.disabled = false;
            generateBtn.textContent = '‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏ö‡∏á‡∏≤‡∏ô';
            prepareAnswerKey();
        }

        function prepareAnswerKey() {
            let keyHtml = '';
            let printKeyHtml = '<h1 class="text-2xl font-bold p-4">‡πÄ‡∏â‡∏•‡∏¢‡πÉ‡∏ö‡∏á‡∏≤‡∏ô</h1><div class="p-4">';
            generatedProblems.forEach((prob, index) => {
                const line = `${index + 1}) ${prob.question} = ${prob.answer}`;
                keyHtml += `<div>${line}</div>`;
                printKeyHtml += `<div class="text-xl mb-2">${line}</div>`;
            });
            printKeyHtml += '</div>';

            answerKeyContent.innerHTML = keyHtml;
            printAnswerKeyContainer.innerHTML = printKeyHtml;
        }

        generateBtn.addEventListener('click', generateWorksheet);
        showAnswerKeyBtn.addEventListener('click', () => answerKeyModal.classList.replace('hidden', 'flex'));
        closeAnswerKeyBtn.addEventListener('click', () => answerKeyModal.classList.replace('flex', 'hidden'));
        answerKeyModal.addEventListener('click', (e) => {
            if (e.target === answerKeyModal) answerKeyModal.classList.replace('flex', 'hidden');
        });

        window.onload = () => {
            toggleRangeSettings(1);
            toggleRangeSettings(2);
            toggleAnswerSettings();
            generateWorksheet();
        };
    </script>
</body>
</html>